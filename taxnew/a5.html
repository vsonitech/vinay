<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto-Generating Arrear Sheet</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; font-size: 12px; }
        
        /* --- Form Styles --- */
        .form-section { background: #f9f9f9; padding: 20px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 20px; max-width: 1000px; margin: 0 auto; }
        .form-section h2 { margin-top: 0; color: #395cb5; text-align: center; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: bold; margin-bottom: 5px; font-size: 11px; }
        .form-group input { padding: 6px; border: 1px solid #ccc; border-radius: 4px; font-size: 13px; }
        .section-title { grid-column: 1 / -1; background: #395cb5; color: white; padding: 8px; margin-top: 15px; border-radius: 4px; font-weight: bold; }
        .btn-container { text-align: center; margin-top: 25px; }
        button { padding: 10px 25px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 15px; font-weight: bold; }
        button:hover { background: #218838; }

        /* --- Sheet Styles --- */
        .sheet-container { display: none; border: 1px solid #000; padding: 15px; background: #fff; max-width: 1400px; margin: 0 auto; }
        .header-banner { background-color: #395cb5; color: white; text-align: center; font-size: 18px; font-weight: bold; padding: 10px; margin-bottom: 10px; }
        .school-name { text-align: center; font-weight: bold; font-size: 15px; margin-bottom: 15px; }
        
        .emp-details { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 13px; padding: 0 10px; }
        .emp-details div { line-height: 1.8; }
        .emp-details strong { display: inline-block; width: 90px; }
        
        table { width: 100%; border-collapse: collapse; text-align: center; font-size: 11px; }
        th, td { border: 1px solid #000; padding: 5px 3px; }
        th { background-color: #e6f0ff; }
        .vertical-text { writing-mode: vertical-rl; transform: rotate(180deg); white-space: nowrap; padding: 10px 2px !important; }
        
        .blue-text { color: #0000ff; }
        .red-text { color: #ff0000; font-weight: bold; }
        .green-text { color: #00a000; font-weight: bold; font-size: 12px; }
        .text-left { text-align: left; padding-left: 10px; font-weight: bold; }
        .bold-row { font-weight: bold; background-color: #f8f9fa; }
        
        .signatures { display: flex; justify-content: space-between; margin-top: 50px; padding: 0 30px; }
        .signatures div { text-align: center; font-weight: bold; }

        .actions { margin-bottom: 20px; text-align: center; display: none; }
        .actions button { background: #007bff; margin: 0 10px; }
        .actions button.edit-btn { background: #6c757d; }

        @media print {
            .form-section, .actions { display: none !important; }
            .sheet-container { display: block !important; border: none; padding: 0; }
            @page { size: landscape; margin: 10mm; }
        }
    </style>
</head>
<body>

    <div class="form-section" id="inputForm">
        <h2>Difference Arrear Auto-Generator</h2>
        <form id="arrearForm">
            <div class="form-grid">
                <div class="section-title">Employee & Office Details</div>
                <div class="form-group"><label>School/Office Name</label><input type="text" id="i_school" value="OFFICE SCHOOL NAME GOES HERE"></div>
                <div class="form-group"><label>Employee Name</label><input type="text" id="i_name" value="EMPLOYEE NAME"></div>
                <div class="form-group"><label>Post</label><input type="text" id="i_post" value="SR. TEACHER"></div>
                <div class="form-group"><label>Pay Matrix</label><input type="text" id="i_matrix" value="L-12"></div>
                <div class="form-group"><label>GPF/PRAN No</label><input type="text" id="i_gpf" value="GPF-2004"></div>
                <div class="form-group"><label>Posting Place</label><input type="text" id="i_place" value="SCHOOL PLACE"></div>
                
                <div class="form-group"><label>Start Month</label><input type="month" id="i_start" required></div>
                <div class="form-group"><label>End Month</label><input type="month" id="i_end" required></div>

                <div class="section-title">Monthly Pay Due (New Salary)</div>
                <div class="form-group"><label>Basic Pay</label><input type="number" id="due_basic" value="90000"></div>
                <div class="form-group"><label>DA %</label><input type="number" id="due_da_perc" value="50"></div>
                <div class="form-group"><label>HRA %</label><input type="number" id="due_hra_perc" value="9"></div>
                <div class="form-group"><label>NPS</label><input type="number" id="due_nps" value="1500"></div>
                <div class="form-group"><label>SI</label><input type="number" id="due_si" value="0"></div>
                <div class="form-group"><label>RGHS</label><input type="number" id="due_rghs" value="600"></div>

                <div class="section-title">Monthly Pay Drawn (Old Salary)</div>
                <div class="form-group"><label>Basic Pay</label><input type="number" id="drawn_basic" value="84000"></div>
                <div class="form-group"><label>DA %</label><input type="number" id="drawn_da_perc" value="50"></div>
                <div class="form-group"><label>HRA %</label><input type="number" id="drawn_hra_perc" value="9"></div>
                <div class="form-group"><label>NPS Deducted</label><input type="number" id="drawn_nps" value="1200"></div>
                <div class="form-group"><label>SI Deducted</label><input type="number" id="drawn_si" value="0"></div>
                <div class="form-group"><label>RGHS Deducted</label><input type="number" id="drawn_rghs" value="300"></div>

                <div class="section-title">One-Time Deductions (Applied to Grand Total)</div>
                <div class="form-group"><label>Arrear GPF</label><input type="number" id="t_gpf" value="18000"></div>
                <div class="form-group"><label>Income Tax (IT)</label><input type="number" id="t_it" value="600"></div>
            </div>
            <div class="btn-container">
                <button type="button" onclick="generateSheet()">Generate Arrear Sheet</button>
            </div>
        </form>
    </div>

    <div class="actions" id="actionButtons">
        <button onclick="window.print()">Print / Save as PDF</button>
        <button class="edit-btn" onclick="editDetails()">Back to Edit Details</button>
    </div>

    <div class="sheet-container" id="outputSheet">
        <div class="header-banner">Difference Arrear Sheet</div>
        <div class="school-name" id="o_school"></div>
        
        <div class="emp-details">
            <div>
                <div><strong>Name:</strong> <span id="o_name"></span></div>
                <div><strong>Post:</strong> <span id="o_post"></span></div>
                <div><strong>Pay Matrix:</strong> <span id="o_matrix"></span></div>
            </div>
            <div>
                <div><strong>GPF:</strong> <span id="o_gpf"></span></div>
                <div><strong>Arrear From:</strong> <span id="o_period"></span></div>
                <div><strong>Posting:</strong> <span id="o_place"></span></div>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th rowspan="2">Sr</th>
                    <th rowspan="2" style="min-width: 60px;">Month</th>
                    <th colspan="4">Pay Due</th>
                    <th colspan="4">Pay Drawn</th>
                    <th colspan="4">Pay Diff</th>
                    <th colspan="3">NPS</th>
                    <th colspan="3">SI</th>
                    <th colspan="3">Corona</th>
                    <th colspan="3">RGHS</th>
                    <th rowspan="2" class="vertical-text">Arrear GPF</th>
                    <th rowspan="2" class="vertical-text">IT</th>
                    <th rowspan="2" class="vertical-text">Total Ded</th>
                    <th rowspan="2" class="vertical-text">Net Pay</th>
                    <th rowspan="2" class="vertical-text">Bill No</th>
                    <th rowspan="2" class="vertical-text">Encash</th>
                </tr>
                <tr>
                    <th>P</th><th>DA</th><th>H</th><th>T</th>
                    <th>P</th><th>DA</th><th>H</th><th>T</th>
                    <th>P</th><th>DA</th><th>H</th><th>T</th>
                    <th>D</th><th>Ded</th><th>Df</th>
                    <th>D</th><th>Ded</th><th>Df</th>
                    <th>D</th><th>Ded</th><th>Df</th>
                    <th>D</th><th>Ded</th><th>Df</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
            <tfoot>
                <tr class="bold-row" id="grandTotalRow">
                    </tr>
                <tr>
                    <td colspan="2" class="bold-row">Net Pay (In Words)</td>
                    <td colspan="32" class="text-left" id="o_words"></td>
                </tr>
            </tfoot>
        </table>

        <div class="signatures">
            <div>
                Employee Name<br>
                <span id="sig_name" style="display:inline-block; margin-top:5px; border-bottom: 1px dashed #000; min-width:150px;"></span>
            </div>
            <div>
                Drawing & Dispersal Officer<br>
                Signature & Seal
            </div>
        </div>
    </div>

    <script>
        // Number to Words Converter
        function numberToWords(num) {
            if (num === 0) return 'Zero Only';
            let a = ['','One ','Two ','Three ','Four ', 'Five ','Six ','Seven ','Eight ','Nine ','Ten ','Eleven ','Twelve ','Thirteen ','Fourteen ','Fifteen ','Sixteen ','Seventeen ','Eighteen ','Nineteen '];
            let b = ['', '', 'Twenty','Thirty','Forty','Fifty', 'Sixty','Seventy','Eighty','Ninety'];
            if ((num = num.toString()).length > 9) return 'Overflow';
            let n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
            if (!n) return; let str = '';
            str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'Crore ' : '';
            str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'Lakh ' : '';
            str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'Thousand ' : '';
            str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'Hundred ' : '';
            str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) : '';
            return str.trim() + ' Only';
        }

        // Generate Month Array
        function getMonthsBetween(start, end) {
            const startDate = new Date(start);
            const endDate = new Date(end);
            const months = [];
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            
            let current = new Date(startDate);
            while (current <= endDate) {
                let mName = monthNames[current.getMonth()];
                let yName = current.getFullYear().toString().substr(-2);
                months.push(`${mName}-${yName}`);
                current.setMonth(current.getMonth() + 1);
            }
            return months;
        }

        function generateSheet() {
            // Validate dates
            const startInput = document.getElementById('i_start').value;
            const endInput = document.getElementById('i_end').value;
            if (!startInput || !endInput) {
                alert("Please select both Start Month and End Month.");
                return;
            }

            const months = getMonthsBetween(startInput, endInput);
            if(months.length === 0) {
                alert("End date must be after start date.");
                return;
            }

            // Fill Header details
            document.getElementById('o_school').innerText = document.getElementById('i_school').value.toUpperCase();
            document.getElementById('o_name').innerText = document.getElementById('i_name').value.toUpperCase();
            document.getElementById('sig_name').innerText = document.getElementById('i_name').value.toUpperCase();
            document.getElementById('o_post').innerText = document.getElementById('i_post').value.toUpperCase();
            document.getElementById('o_matrix').innerText = document.getElementById('i_matrix').value.toUpperCase();
            document.getElementById('o_gpf').innerText = document.getElementById('i_gpf').value.toUpperCase();
            document.getElementById('o_place').innerText = document.getElementById('i_place').value.toUpperCase();
            document.getElementById('o_period').innerText = `${months[0]} to ${months[months.length-1]}`;

            // Helper to get numbers
            const getVal = (id) => parseFloat(document.getElementById(id).value) || 0;

            // Monthly Due logic
            const due_p = getVal('due_basic');
            const due_da = Math.round(due_p * (getVal('due_da_perc') / 100));
            const due_h = Math.round(due_p * (getVal('due_hra_perc') / 100));
            const due_t = due_p + due_da + due_h;
            
            const due_nps = getVal('due_nps');
            const due_si = getVal('due_si');
            const due_rghs = getVal('due_rghs');

            // Monthly Drawn logic
            const dr_p = getVal('drawn_basic');
            const dr_da = Math.round(dr_p * (getVal('drawn_da_perc') / 100));
            const dr_h = Math.round(dr_p * (getVal('drawn_hra_perc') / 100));
            const dr_t = dr_p + dr_da + dr_h;

            const dr_nps = getVal('drawn_nps');
            const dr_si = getVal('drawn_si');
            const dr_rghs = getVal('drawn_rghs');

            // Monthly Differences
            const df_p = due_p - dr_p;
            const df_da = due_da - dr_da;
            const df_h = due_h - dr_h;
            const df_t = due_t - dr_t;

            const df_nps = due_nps - dr_nps;
            const df_si = due_si - dr_si;
            const df_rghs = due_rghs - dr_rghs;
            const df_cor = 0; // Corona usually 0

            // Initialize Grand Totals Object
            let GT = {
                due_p:0, due_da:0, due_h:0, due_t:0,
                dr_p:0, dr_da:0, dr_h:0, dr_t:0,
                df_p:0, df_da:0, df_h:0, df_t:0,
                nps_d:0, nps_ded:0, nps_df:0,
                si_d:0, si_ded:0, si_df:0,
                rghs_d:0, rghs_ded:0, rghs_df:0
            };

            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = ''; // Clear old rows

            // Generate Monthly Rows
            months.forEach((month, index) => {
                // Accumulate totals
                GT.due_p += due_p; GT.due_da += due_da; GT.due_h += due_h; GT.due_t += due_t;
                GT.dr_p += dr_p; GT.dr_da += dr_da; GT.dr_h += dr_h; GT.dr_t += dr_t;
                GT.df_p += df_p; GT.df_da += df_da; GT.df_h += df_h; GT.df_t += df_t;
                
                GT.nps_d += due_nps; GT.nps_ded += dr_nps; GT.nps_df += df_nps;
                GT.si_d += due_si; GT.si_ded += dr_si; GT.si_df += df_si;
                GT.rghs_d += due_rghs; GT.rghs_ded += dr_rghs; GT.rghs_df += df_rghs;

                let row = `<tr>
                    <td>${index + 1}</td>
                    <td>${month}</td>
                    <td>${due_p}</td><td>${due_da}</td><td>${due_h}</td><td class="blue-text">${due_t}</td>
                    <td>${dr_p}</td><td>${dr_da}</td><td>${dr_h}</td><td class="blue-text">${dr_t}</td>
                    <td>${df_p}</td><td>${df_da}</td><td>${df_h}</td><td class="blue-text">${df_t}</td>
                    
                    <td>${due_nps}</td><td>${dr_nps}</td><td class="blue-text">${df_nps}</td>
                    <td>${due_si}</td><td>${dr_si}</td><td class="blue-text">${df_si}</td>
                    <td>0</td><td>0</td><td class="blue-text">0</td>
                    <td>${due_rghs}</td><td>${dr_rghs}</td><td class="blue-text">${df_rghs}</td>
                    
                    <td></td><td></td><td></td><td></td><td></td><td></td>
                </tr>`;
                tbody.innerHTML += row;
            });

            // Calculate Final Deductions on Grand Total
            const arr_gpf = getVal('t_gpf');
            const arr_it = getVal('t_it');
            const total_deductions = GT.nps_df + GT.si_df + 0 + GT.rghs_df + arr_gpf + arr_it; // 0 is Corona
            const net_pay = GT.df_t - total_deductions;

            // Generate Grand Total Row
            const gtRow = document.getElementById('grandTotalRow');
            gtRow.innerHTML = `
                <td colspan="2" style="text-align: right; padding-right: 10px;">GRAND TOTAL</td>
                
                <td class="blue-text">${GT.due_p}</td><td class="blue-text">${GT.due_da}</td>
                <td class="blue-text">${GT.due_h}</td><td class="blue-text">${GT.due_t}</td>
                
                <td class="blue-text">${GT.dr_p}</td><td class="blue-text">${GT.dr_da}</td>
                <td class="blue-text">${GT.dr_h}</td><td class="blue-text">${GT.dr_t}</td>
                
                <td class="blue-text">${GT.df_p}</td><td class="blue-text">${GT.df_da}</td>
                <td class="blue-text">${GT.df_h}</td><td class="blue-text">${GT.df_t}</td>
                
                <td class="blue-text">${GT.nps_d}</td><td class="blue-text">${GT.nps_ded}</td><td class="blue-text">${GT.nps_df}</td>
                <td class="blue-text">${GT.si_d}</td><td class="blue-text">${GT.si_ded}</td><td class="blue-text">${GT.si_df}</td>
                <td class="blue-text">0</td><td class="blue-text">0</td><td class="blue-text">0</td>
                <td class="blue-text">${GT.rghs_d}</td><td class="blue-text">${GT.rghs_ded}</td><td class="blue-text">${GT.rghs_df}</td>
                
                <td class="blue-text">${arr_gpf}</td>
                <td class="blue-text">${arr_it}</td>
                <td class="red-text">${total_deductions}</td>
                <td class="green-text">${net_pay}</td>
                <td></td><td></td>
            `;

            // Words
            document.getElementById('o_words').innerText = 'Rupees ' + numberToWords(net_pay);

            // Toggle UI
            document.getElementById('inputForm').style.display = 'none';
            document.getElementById('actionButtons').style.display = 'block';
            document.getElementById('outputSheet').style.display = 'block';
        }

        function editDetails() {
            document.getElementById('inputForm').style.display = 'block';
            document.getElementById('actionButtons').style.display = 'none';
            document.getElementById('outputSheet').style.display = 'none';
        }
    </script>
</body>
                      </html>
  
