<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Image & PDF Compressor</title>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body{
  font-family:Calibri,Arial;
  background:#f4f6f9;
  margin:0;
}

.container{
  max-width:520px;
  margin:auto;
  background:#fff;
  padding:20px;
  box-shadow:0 0 10px rgba(0,0,0,.08);
  border-radius:10px;
}

h2{
  text-align:center;
  margin-top:5px;
}

.type-select{
  text-align:center;
  margin-bottom:10px;
}

.upload-box{
  border:2px dashed #cbd5e1;
  padding:20px;
  text-align:center;
  border-radius:8px;
  cursor:pointer;
  background:#f8fafc;
  transition:.3s;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:bold;
  font-size:15px;
}
.upload-box:hover{
  background:#eef2ff;
}
input[type=file]{display:none;}

input[type=number]{
  width:100%;
  padding:8px;
  margin-top:8px;
}

button{
  background:#2563eb;
  color:#fff;
  border:none;
  padding:10px;
  width:100%;
  margin-top:15px;
  border-radius:6px;
  font-size:15px;
  cursor:pointer;
}
button:hover{
  background:#1e40af;
}

.progress{
  height:8px;
  background:#e5e7eb;
  border-radius:4px;
  margin-top:15px;
  overflow:hidden;
  display:none;
}
.progress-bar{
  height:100%;
  width:0%;
  background:#22c55e;
  transition:.4s;
}

.file-list{
  margin-top:10px;
  font-size:14px;
}

.preview img{
  max-width:100%;
  margin-top:10px;
  border-radius:6px;
}

.success{
  background:#ecfdf5;
  color:#065f46;
  padding:10px;
  border-radius:6px;
  margin-top:15px;
  display:none;
}

.download-area div{
  margin-top:12px;
  padding:10px;
  background:#f8fafc;
  border-radius:8px;
  font-size:14px;
}

footer{
  margin-top:20px;
  padding:15px;
  text-align:center;
  font-size:14px;
  background:#111827;   /* Dark gray instead of blue */
  color:#e5e7eb;
  border-radius:10px;
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(5px);}
  to{opacity:1;transform:translateY(0);}
}
</style>
</head>

<body>
<div class="container">

<h2>Smart Image & PDF Compressor</h2>

<div class="type-select">
  <label>
    <input type="radio" name="fileType" value="image" checked> Image
  </label>
  &nbsp;&nbsp;
  <label style="color:gray;">
    <input type="radio" name="fileType" value="pdf" disabled> PDF (Coming Soon)
  </label>
</div>

<p style="font-size:14px;text-align:center">
Select up to <b>3 files</b>
</p>

<label class="upload-box">
  Choose Files
  <input type="file" id="fileInput" multiple accept="image/*" style="display:none;">
</label>

<div class="file-list" id="fileList"></div>

<label><b>Select how many KB</b></label>
<input type="number" id="targetKB" value="50">

<button onclick="startCompression()">Compress Files</button>

<div class="progress" id="progressBox">
  <div class="progress-bar" id="progressBar"></div>
</div>

<div class="preview" id="preview"></div>
<div class="success" id="successMsg"></div>
<div class="download-area" id="downloadArea"></div>

<footer>
Smart Compressor Tool ‚Ä¢ Free Online Utility <br>
Designed by with ‚ù§Ô∏è by Vinay Soni
</footer>

</div>

<script>

const fileInput = document.getElementById("fileInput");
const fileList = document.getElementById("fileList");
const progressBox = document.getElementById("progressBox");
const progressBar = document.getElementById("progressBar");
const successMsg = document.getElementById("successMsg");
const downloadArea = document.getElementById("downloadArea");
const preview = document.getElementById("preview");

fileInput.addEventListener("change", validateFiles);

function switchType(){
  const type = document.querySelector('input[name="fileType"]:checked').value;
  fileInput.accept = (type==="image") ? "image/*" : "application/pdf";
  fileInput.value="";
  fileList.innerHTML="";
}

function validateFiles(){
  const files = fileInput.files;

  if(files.length > 3){
    alert("Maximum 3 files allowed.");
    fileInput.value="";
    fileList.innerHTML="";
    return;
  }

  let list="";
  for(let i=0;i<files.length;i++){
    let icon = files[i].type.includes("image") ? "üñº" : "üìÑ";
    let sizeKB = (files[i].size/1024).toFixed(1);
    list += `${i+1}. ${icon} ${files[i].name} (${sizeKB} KB)<br>`;
  }
  fileList.innerHTML=list;
}

async function startCompression(){
  const files = fileInput.files;

  if(!files.length){
    alert("Please select image file(s)");
    return;
  }

  if(files.length > 3){
    alert("Maximum 3 files allowed.");
    return;
  }

  const targetKB = parseInt(document.getElementById("targetKB").value);

  progressBox.style.display="block";
  progressBar.style.width="0%";
  successMsg.style.display="none";
  downloadArea.innerHTML="";
  preview.innerHTML="";

  for(let i=0;i<files.length;i++){

    if(!files[i].type.includes("image")){
      alert("Only image files allowed.");
      return;
    }

    const originalSizeKB = (files[i].size/1024).toFixed(1);

    const compressedBlob = await compressImage(files[i],targetKB);

    showPreview(compressedBlob);

    createDownloadButton(compressedBlob, files[i].name, originalSizeKB, targetKB);

    progressBar.style.width=((i+1)/files.length*100)+"%";
  }

  successMsg.style.display="block";
  successMsg.style.animation="fadeIn 0.5s ease-in-out";
  successMsg.innerHTML="üéâ Image Compression Completed Successfully!";
}
      function reduce(){
        canvas.toBlob(function(blob){
          if(blob.size/1024<=targetKB || quality<=0.1){
            resolve(blob);
          } else {
            quality-=0.1;
            reduce();
          }
        },"image/jpeg",quality);
      }
      reduce();
    };
  });
}

async function compressPDF(file){
  const { PDFDocument } = PDFLib;

  const arrayBuffer = await file.arrayBuffer();
  const pdfDoc = await PDFDocument.load(arrayBuffer);

  // Remove metadata (reduces size slightly)
  pdfDoc.setTitle("");
  pdfDoc.setAuthor("");
  pdfDoc.setSubject("");
  pdfDoc.setProducer("");

  const compressedBytes = await pdfDoc.save({
    useObjectStreams: true,
    compress: true,
    addDefaultPage: false
  });

  return new Blob([compressedBytes], { type: "application/pdf" });
}

function showPreview(blob){
  const img=document.createElement("img");
  img.src=URL.createObjectURL(blob);
  preview.appendChild(img);
}

function createDownloadButton(blob, originalName, originalSizeKB, targetKB){

  const compressedSizeKB=(blob.size/1024).toFixed(1);
  const reduction=((1-(blob.size/(originalSizeKB*1024)))*100).toFixed(1);

  const newName=originalName.replace(/\.[^/.]+$/,"")+"_"+targetKB+"KB."+originalName.split('.').pop();

  const wrapper=document.createElement("div");

  wrapper.innerHTML=`
    <b>${newName}</b><br>
    Original: ${originalSizeKB} KB <br>
    Compressed: ${compressedSizeKB} KB <br>
    Reduction: <span style="color:green;font-weight:bold">${reduction}%</span>
  `;

  const btn=document.createElement("button");
  btn.textContent="‚¨á Download";
  btn.onclick=function(){
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download=newName;
    a.click();
  };

  wrapper.appendChild(btn);
  downloadArea.appendChild(wrapper);
}

</script>
</body>
</html>
