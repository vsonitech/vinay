<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Image & PDF Compressor</title>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body{
  font-family:Arial, sans-serif;
  background:#f4f6f9;
  margin:0;
}
.container{
  max-width:520px;
  margin:auto;
  background:#fff;
  padding:20px;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}
h2{text-align:center;margin-top:5px}
.home-btn{
  text-decoration:none;
  color:#2563eb;
  font-size:14px;
}
.upload-box{
  border:2px dashed #cbd5e1;
  padding:20px;
  text-align:center;
  border-radius:8px;
  cursor:pointer;
  background:#f8fafc;
}
.upload-box:hover{background:#eef2ff}
input[type=file]{display:none}
input[type=number]{
  width:100%;
  padding:10px;
  margin-top:8px;
}
button{
  background:#2563eb;
  color:#fff;
  border:none;
  padding:12px;
  width:100%;
  margin-top:15px;
  border-radius:6px;
  font-size:16px;
  cursor:pointer;
}
button:hover{background:#1e40af}
.progress{
  height:8px;
  background:#e5e7eb;
  border-radius:4px;
  margin-top:15px;
  overflow:hidden;
  display:none;
}
.progress-bar{
  height:100%;
  width:0%;
  background:#22c55e;
}
.preview img{
  max-width:100%;
  margin-top:10px;
  border-radius:6px;
}
.file-list{
  margin-top:10px;
  font-size:14px;
}
.success{
  background:#ecfdf5;
  color:#065f46;
  padding:10px;
  border-radius:6px;
  margin-top:15px;
  display:none;
}
.download a{
  display:block;
  margin-top:10px;
  text-decoration:none;
  color:#2563eb;
  font-weight:bold;
}
footer{
  margin-top:auto;
  text-align:center;
  font-size:13px;
  color:#6b7280;
  padding-top:20px;
}
</style>
</head>

<body>
<div class="container">

<a class="home-btn" href="#">← Home</a>

<h2>Smart Image & PDF Compressor</h2>

<p style="font-size:14px;text-align:center">
Select up to <b>3 files</b> (Image or PDF)
</p>

<label class="upload-box">
Choose Files
<input type="file" id="fileInput" multiple accept="image/*,application/pdf">
</label>

<div class="file-list" id="fileList"></div>

<label><b>Select how many KB</b></label>
<input type="number" id="targetKB" value="50">

<button onclick="startCompression()">Compress Files</button>

<div class="progress" id="progressBox">
  <div class="progress-bar" id="progressBar"></div>
</div>

<div class="preview" id="preview"></div>
<div class="success" id="successMsg"></div>
<div class="download" id="downloadLinks"></div>

<footer>
© 2026 • Smart Compressor • Built with ❤️ by <b>Vinay Soni</b>
</footer>

</div>

<script>
const fileInput = document.getElementById("fileInput");
const fileList = document.getElementById("fileList");

fileInput.addEventListener("change", validateFiles);

function validateFiles(){
  const files = fileInput.files;

  if(files.length > 3){
    alert("You can select maximum 3 files only.");
    fileInput.value="";
    fileList.innerHTML="";
    return;
  }

  let list="";
  for(let i=0;i<files.length;i++){
    list += (i+1)+". "+files[i].name+" ("+(files[i].size/1024).toFixed(1)+" KB)<br>";
  }
  fileList.innerHTML = list;
}

async function startCompression(){
  const files = fileInput.files;
  if(!files.length) return;

  document.getElementById("progressBox").style.display="block";
  document.getElementById("successMsg").style.display="none";
  document.getElementById("downloadLinks").innerHTML="";
  document.getElementById("preview").innerHTML="";

  const targetKB = parseInt(document.getElementById("targetKB").value);
  const progressBar = document.getElementById("progressBar");

  for(let i=0;i<files.length;i++){
    progressBar.style.width = ((i+1)/files.length*100)+"%";

    let compressed;
    if(files[i].type.includes("image")){
      compressed = await compressImage(files[i], targetKB);
      showPreview(compressed);
    }else{
      compressed = await compressPDF(files[i]);
    }

    createDownload(compressed, files[i].name);
  }

  document.getElementById("successMsg").style.display="block";
  document.getElementById("successMsg").innerHTML="✅ Files compressed successfully!";
}

function compressImage(file, targetKB){
  return new Promise(resolve=>{
    const img = new Image();
    img.src = URL.createObjectURL(file);
    img.onload = ()=>{
      const canvas = document.createElement("canvas");
      canvas.width = img.width;
      canvas.height = img.height;
      canvas.getContext("2d").drawImage(img,0,0);

      let quality = 0.7;
      let blob;

      function reduce(){
        canvas.toBlob(b=>{
          if(b.size/1024 <= targetKB || quality <= 0.1){
            resolve(b);
          }else{
            quality -= 0.1;
            reduce();
          }
        },"image/jpeg",quality);
      }
      reduce();
    };
  });
}

async function compressPDF(file){
  const { PDFDocument } = PDFLib;
  const buffer = await file.arrayBuffer();
  const pdfDoc = await PDFDocument.load(buffer);
  const pdfBytes = await pdfDoc.save({
    useObjectStreams:true,
    compress:true
  });
  return new Blob([pdfBytes],{type:"application/pdf"});
}

function showPreview(blob){
  const img = document.createElement("img");
  img.src = URL.createObjectURL(blob);
  document.getElementById("preview").appendChild(img);
}

function createDownload(blob, name){
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "compressed_"+name;
  a.textContent = "⬇ Download "+a.download;
  document.getElementById("downloadLinks").appendChild(a);
}
</script>
</body>
</html>
